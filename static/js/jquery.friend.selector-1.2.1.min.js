/*!
 * Facebook Friend Selector
 * Copyright (c) 2013 Coders' Grave - http://codersgrave.com
 * Version: 1.2.1
 * Requires:
 *   jQuery v1.6.2 or above
 *   Facebook Integration - http://developers.facebook.com/docs/reference/javascript/
 */
$(document).ready(function(){function e(e){var t=null;if(document.cookie&&document.cookie!=""){var n=document.cookie.split(";");for(var r=0;r<n.length;r++){var i=jQuery.trim(n[r]);if(i.substring(0,e.length+1)==e+"="){t=decodeURIComponent(i.substring(e.length+1));break}}}return t}function n(e){return/^(GET|HEAD|OPTIONS|TRACE)$/.test(e)}function r(e){function t(e){if(e.status=="failure"){$message.html(e.name+" hasn't talked to you in forever!  Maybe you should do something about that.  Try picking someone else.")}else{$findFriendImg.off();$findFriendImg.animate({opacity:0});$("#percentage").removeClass("black");$.ajax({type:"POST",url:"/sentiment/",data:e,success:function(e){e=$.parseJSON(e);var t=$("#sentiment");var n=t.text();var r=e.sentiment;var i=setInterval(function(){if(n==r){clearInterval(i);$("#share").removeClass("black");$shareImg.click(function(t){FB.ui({method:"feed",link:"http://issheintome.herokuapp.com/",caption:e.name+" has a "+r+"% romantic interest in me!"},function(e){if(e&&e.post_id){$shareImg.animate({opacity:0});$("#share").removeClass("black");$shareImg.off()}})});$message.html(e.message)}else{n++;t.text(n)}},100)}})}}function n(e,t){for(var n=0;n<e.length;n++){if(e[n].to.data.length==2){if(e[n].to.data[0].id==romInterest.id||e[n].to.data[1].id==romInterest.id){var r=e[n].comments.data;var i="";for(var n=0;n<r.length;n++){if(r[n].from.id==romInterest.id){i+=" "+r[n].message}}if(i!=""){t({text:i,status:"success",name:romInterest.name});return}}}}t({status:"failure",name:romInterest.name})}n(e.data,t)}var t=e("csrftoken");$.ajaxSetup({crossDomain:false,beforeSend:function(e,r){if(!n(r.type)){e.setRequestHeader("X-CSRFToken",t)}}});$authImg=$("#auth-img");$findFriendImg=$("#find-friend-img");$shareImg=$("#share-img");$message=$("#message");window.fbAsyncInit=function(){function e(e){if(e.authResponse){$authImg.animate({opacity:0});$("#find-friend").removeClass("black")}else{$authImg.click(function(e){e.preventDefault();FB.login(function(e){if(e.authResponse){$authImg.animate({opacity:0});$("#find-friend").removeClass("black");$authImg.off();$findFriendImg.click(function(e){e.preventDefault();$findFriendImg.fSelector({onSubmit:function(e){if(e.length>0){FB.api("/"+e[0],function(t){romInterest={id:e[0],name:t.name}});FB.api("/me/inbox",{limit:20},function(e){if(!e||e.error){$message.html("Sorry, Facebook says you've maxed out on your tries!  Please try again in 5 minutes.")}else{r(e)}})}else{$message.html("Please select someone!")}},facebookInvite:false,closeOnSubmit:true,max:1,showButtonSelectAll:false,showSelectedCount:true,lang:{title:"Select a friend",buttonSubmit:"OK"}})})}else{}},{scope:"read_mailbox"})})}}FB.init({appId:"1400427420196243",status:true,cookie:true,xfbml:true,oauth:true});FB.getLoginStatus(e);FB.Event.subscribe("auth.statusChange",e)};(function(){var e=document.createElement("script");e.async=true;e.src=document.location.protocol+"//connect.facebook.net/en_US/all.js";document.getElementById("fb-root").appendChild(e)})()})